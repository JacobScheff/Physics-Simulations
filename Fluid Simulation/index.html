<script>
    let width = 550
    let height = 600
    let canvas;
    let ctx;

    let ballRadius = 5
    let balls = []
    let ballPadding = 30
    let xCount = 20
    let yCount = 20
    let fps = 150
    // gravity = 640
    let gravity = 0
    collisionMultiplier = 0.8

    class Ball {
        constructor(x, y, vx, vy) {
            this.x = x
            this.y = y
            this.vx = vx
            this.vy = vy
            this.radius = ballRadius
            this.mass = Math.pow(this.radius, 2) * Math.PI
        }

        draw() {
            ctx.beginPath()
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2)
            ctx.fillStyle = "white"
            ctx.fill()
            ctx.closePath()
        }

        move(dt) {
            // Apply gravity
            this.vy += gravity * dt

            // If the ball is going to hit the wall, reverse the velocity
            if (this.x < this.radius) {
                this.vx = Math.abs(this.vx) * collisionMultiplier
            }
            else if (this.x > width - this.radius) {
                this.vx = -Math.abs(this.vx) * collisionMultiplier
            }
            if (this.y < this.radius) {
                this.vy = Math.abs(this.vy) * collisionMultiplier
            }
            else if (this.y > height - this.radius) {
                this.vy = -Math.abs(this.vy) * collisionMultiplier
            }

            // Move the ball
            this.x += this.vx * dt
            this.y += this.vy * dt
        }

        applyForce(other) {
            // Apply a repulsive force between the two balls
            let distance = Math.sqrt(Math.pow(this.x - other.x, 2) + Math.pow(this.y - other.y, 2))
            let forceMultiplier = 0.0064
            let forceMagnitude = forceMultiplier * Math.pow(((this.radius + other.radius) / distance), 2)
            // Apply the force so that they are pushed away from each other using trigonometry
            let angle = Math.atan2(this.y - other.y, this.x - other.x)
            let angleSin = Math.sin(angle)
            let angleCos = Math.cos(angle)
            this.vx += forceMagnitude * angleCos * this.mass
            this.vy += forceMagnitude * angleSin * this.mass
            other.vx -= forceMagnitude * angleCos * other.mass
            other.vy -= forceMagnitude * angleSin * other.mass
        }
    }

    setTimeout(() => {
        canvas = document.querySelector('canvas')
        ctx = canvas.getContext('2d')

        for (let x = 0; x < xCount; x++) {
            for (let y = 0; y < yCount; y++) {
                balls.push(new Ball(ballPadding + x * (width - ballPadding * 2) / (xCount - 1), ballPadding + y * (height - ballPadding * 2) / (yCount - 1), 0, 0))
            }
        }

        setInterval(() => {
            // Make the screen black
            ctx.fillStyle = "black"
            ctx.fillRect(0, 0, width, height)

            for (let i = 0; i < balls.length; i++) {
                balls[i].move(1 / fps)
                for (let j = 0; j < balls.length; j++) {
                    if (i != j) {
                        balls[i].applyForce(balls[j])
                    }
                }
                balls[i].draw()
            }

        }, 1000 / fps)

    }, 100)



</script>

<body>
    <canvas width="1000" height="1000"></canvas>
</body>

<style>
    canvas {
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
</style>